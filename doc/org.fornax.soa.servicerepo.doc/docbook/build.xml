<?xml version="1.0"?>
<project default="create-eclipse-help" basedir="..">

    <property name="current-loc" location="." />
    <property name="workspace" location=".." />

    <!-- html output goes here -->
	<property name="htmldir" value="${current-loc}/html" />
    <!-- path to xsl for eclipse 3.3 or newer -->
    <property name="docbookdir" value="${current-loc}/docbook-xsl/eclipse/eclipse33.xsl" />
    <!--property name="docbookdir" value="${current-loc}/xslt/eclipse.xsl" /-->
    <!-- transformation input comes from here -->
    <property name="docbooksource" value="${current-loc}/docbook"/>
    <!-- temporary transformation output goes here -->
    <property name="docbooksource-tmp" value="${current-loc}/docbook-tmp"/>

	<!-- use apache transformer -->
    <property name="xalan" value="org.apache.xalan.processor.TransformerFactoryImpl" />

	<!-- declare ant task for xinclude -->
    <taskdef name="xinclude" classname="org.eclipse.wst.xsl.core.internal.ant.XIncludeTask"/>

	<!-- XSLT Chunking Properties -->
    <property name="base.dir" value="${htmldir}"/>

	
	<property name="styles.dir" value="${current-loc}/styles" />
	<property name="css.dir" value="${styles.dir}/css" />
	<property name="html-css.file" value="${css.dir}/book.css" />
	<property name="images.dir" value="${current-loc}/docbook/images" />

    <target name="clean" depends="clean-temporary-artifacts" description="Cleans up generated files.">
        <delete dir="${htmldir}" />
    	<delete file="${current-loc}/toc.xml" />
    	<delete file="${current-loc}/plugin.xml" />
    </target>

    <target name="clean-temporary-artifacts" description="Cleans up generated files.">
        <delete dir="${docbooksource-tmp}" />
    	<delete file="${current-loc}/xslt-output.xml" />
    </target>

	<target name="depends">
        <mkdir dir="${htmldir}" />
        <mkdir dir="${docbooksource-tmp}" />
    </target>

    <target name="merge">
        <!-- replace manual.xml with your top level docbook file -->
        <xinclude in="${docbooksource}/manual.xml" out="${docbooksource-tmp}/manualcombined.xml" />
    </target>

    <target name="create-eclipse-help" depends="clean, depends, merge">

		<copy todir="${htmldir}/images">
			<fileset dir="${images.dir}">
				<include name="**/*" />
			</fileset>
		</copy>
		<copy file="${html-css.file}" todir="${basedir}/html" />
        <xslt force="true" style="${docbookdir}" in="${docbooksource-tmp}/manualcombined.xml" out="xslt-output.xml">
            <factory name="${xalan}" />
            <param name="manifest" expression="0"/>
        	<param name="use.id.as.filename" expression="1"/>
            <param name="base.dir" expression="${htmldir}/"/>
            <param name="create.plugin.xml" expression="1"/>
            <param name="chunker.output.indent" expression="yes"/>
        	<param name="chunk.tocs.and.lots" expression="1"/>
            <param name="navig.showtitles" expression="0"/>
            <param name="suppress.navigation" expression="1"/>
            <param name="generate.toc" expression="book      toc,title,figure
chapter   toc,title
section   title" />
        </xslt>
    	
        <replace file="${current-loc}/toc.xml" token="${current-loc}/" value=""/>
        
    	<antcall target="clean-temporary-artifacts" />
    </target>

</project>