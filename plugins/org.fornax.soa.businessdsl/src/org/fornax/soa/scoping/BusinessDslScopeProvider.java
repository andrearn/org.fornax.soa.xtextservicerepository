/*
 * generated by Xtext
 */
package org.fornax.soa.scoping;

import org.eclipse.emf.ecore.EObject;
import org.eclipse.emf.ecore.EReference;
import org.eclipse.xtext.resource.IEObjectDescription;
import org.fornax.soa.basedsl.sOABaseDsl.VersionRef;
import org.fornax.soa.basedsl.scoping.versions.filter.AbstractPredicateVersionFilter;
import org.fornax.soa.basedsl.scoping.versions.filter.NullVersionFilter;
import org.fornax.soa.basedsl.scoping.versions.filter.VersionedImportedNamespaceAwareScopeProvider;
import org.fornax.soa.basedsl.search.IEObjectLookup;
import org.fornax.soa.businessDsl.BusinessDslPackage;
import org.fornax.soa.businessDsl.CapabilityRef;

import com.google.inject.Inject;


/**
 * This class contains custom scoping description.
 * 
 * see : http://www.eclipse.org/Xtext/documentation/latest/xtext.html#scoping
 * on how and when to use it 
 *
 */
public class BusinessDslScopeProvider extends VersionedImportedNamespaceAwareScopeProvider {

	@Inject IEObjectLookup objLookup;
	
	@Override
	protected AbstractPredicateVersionFilter<IEObjectDescription> getVersionFilterFromContext(
			EObject ctx, EReference reference) {
		if (reference==BusinessDslPackage.Literals.CAPABILITY_REF__VERSION_REF && ctx instanceof CapabilityRef) {
			final VersionRef v = ((CapabilityRef) ctx).getVersionRef();
			return createVersionFilter (v, objLookup.getVersionedOwner(ctx));
		}

		return new NullVersionFilter<IEObjectDescription>();
	}

}
