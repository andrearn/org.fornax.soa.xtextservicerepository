«IMPORT serviceDsl»
«IMPORT bindingDsl»
«IMPORT environmentDsl»
«IMPORT moduleDsl»

«EXTENSION org::fornax::soa::bindingdsl::templates::vendor::ibm::scaexports»
«EXTENSION org::fornax::soa::servicedsl::templates::common»
«EXTENSION org::fornax::soa::servicedsl::templates::xsd::domains»
«EXTENSION org::fornax::soa::servicedsl::templates::webservice::services»
«EXTENSION org::fornax::soa::bindingdsl::templates::bindings»
«EXTENSION org::fornax::soa::bindingdsl::templates::soap::soapbinding»
«EXTENSION org::fornax::soa::bindingdsl::queries::services::serviceQueries»

«EXTENSION org::eclipse::xtend::util::stdlib::io»

«DEFINE SCAModuleExport (sOAProfileDsl::SOAProfile profile) FOR bindingDsl::BindingProtocol»
«ENDDEFINE»


«DEFINE SCAModuleExport (sOAProfileDsl::SOAProfile profile) FOR ModuleBinding»
	«IF module.module.assemblyType == AssemblyType::SCA_EAR»
		«FOREACH module.module.providedServices AS provSvc»
			«LET provSvc.latestServiceInEnvironment (environment) AS svc-»
				«IF svc != null»
					«EXPAND ServiceExport (this, svc, profile) FOREACH this.getMostSpecificBinding (svc).protocol»
				«ENDIF»
			«ENDLET»
		«ENDFOREACH»
	«ENDIF»
«ENDDEFINE»

«DEFINE ServiceExport (ModuleBinding modBind, Service svc, sOAProfileDsl::SOAProfile profile) FOR bindingDsl::BindingProtocol»
«ENDDEFINE»

«DEFINE ServiceExport (ModuleBinding modBind, Service svc, sOAProfileDsl::SOAProfile profile) FOR bindingDsl::SOAP»
«FILE svc.getExportFileName (this)-»
<?xml version="1.0" encoding="UTF-8"?>
<scdl:export 
		xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
		xmlns:jaxws="http://www.ibm.com/xmlns/prod/websphere/scdl/jaxws/6.0.0" 
		xmlns:ns1="«svc.toTargetNamespace()»" 
		xmlns:scdl="http://www.ibm.com/xmlns/prod/websphere/scdl/6.0.0" 
		xmlns:wsdl="http://www.ibm.com/xmlns/prod/websphere/scdl/wsdl/6.0.0" 
		displayName="«svc.getExportDisplayName (this)»" 
		name="«svc.getExportName (this)»"> 
	<interfaces>
		<interface xsi:type="wsdl:WSDLPortType" preferredInteractionStyle="sync" portType="ns1:«svc.name»"/>
	</interfaces>
	<esbBinding xsi:type="jaxws:JaxWsExportBinding" port="ns1:«svc.toScopedPortName (this)»" service="ns1:«svc.name»"/>
</scdl:export>
«ENDFILE»
«ENDDEFINE»

«DEFINE SCAModuleExport FOR bindingDsl::SCA»
«ENDDEFINE»